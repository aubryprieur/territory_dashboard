<!-- Comparaison des données enfants -->
<div class="bg-white shadow rounded-lg p-6 mb-6">
  <h2 class="text-lg font-medium text-gray-900 mb-4">Les enfants</h2>

  <div class="flex flex-col md:flex-row gap-8">
    <!-- Tableau pour enfants de moins de 3 ans -->
    <div class="flex-1">
      <h3 class="text-sm font-medium text-gray-700 mb-4">Part des enfants de moins de 3 ans</h3>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Territoire
              </th>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Part dans la population (%)
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr>
              <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                <%= @territory_name %>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                <% commune_rate = @children_data&.dig("under_3_rate") || 0 %>
                <%= number_to_percentage(commune_rate, precision: 2) %>
              </td>
            </tr>

            <% if @epci_children_data.present? %>
              <tr>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 max-w-xs" title="<%= epci_display_name %>">
                  <div class="truncate">
                    <%= display_territory_name(epci_display_name) %>
                  </div>
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                  <% epci_rate = @epci_children_data["under_3_rate"] rescue 0 %>
                  <%= number_to_percentage(epci_rate, precision: 2) %>
                </td>
              </tr>
            <% end %>

            <% if @department_children_data.present? %>
              <tr>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 max-w-xs" title="<%= department_display_name %>">
                  <div class="truncate">
                    <%= display_territory_name(department_display_name) %>
                  </div>
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                  <% dept_rate = @department_children_data["under_3_rate"] rescue 0 %>
                  <%= number_to_percentage(dept_rate, precision: 2) %>
                </td>
              </tr>
            <% end %>

            <% if @region_children_data.present? %>
              <tr>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 max-w-xs" title="<%= region_display_name %>">
                  <div class="truncate">
                    <%= display_territory_name(region_display_name) %>
                  </div>
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                  <% region_rate = @region_children_data["under_3_rate"] rescue 0 %>
                  <%= number_to_percentage(region_rate, precision: 2) %>
                </td>
              </tr>
            <% end %>

            <% if @france_children_data.present? %>
              <tr>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                  France
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                  <% france_rate = @france_children_data["under_3_rate"] rescue 0 %>
                  <%= number_to_percentage(france_rate, precision: 2) %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Tableau pour enfants de 3 à 5 ans -->
    <div class="flex-1">
      <h3 class="text-sm font-medium text-gray-700 mb-4">Part des enfants de 3 à 5 ans</h3>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Territoire
              </th>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Part dans la population (%)
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr>
              <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                <%= @territory_name %>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                <% commune_rate = @children_data&.dig("three_to_five_rate") || 0 %>
                <%= number_to_percentage(commune_rate, precision: 2) %>
              </td>
            </tr>

            <% if @epci_children_data.present? %>
              <tr>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 max-w-xs" title="<%= epci_display_name %>">
                  <div class="truncate">
                    <%= display_territory_name(epci_display_name) %>
                  </div>
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                  <% epci_rate = @epci_children_data["three_to_five_rate"] rescue 0 %>
                  <%= number_to_percentage(epci_rate, precision: 2) %>
                </td>
              </tr>
            <% end %>

            <% if @department_children_data.present? %>
              <tr>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 max-w-xs" title="<%= department_display_name %>">
                  <div class="truncate">
                    <%= display_territory_name(department_display_name) %>
                  </div>
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                  <% dept_rate = @department_children_data["three_to_five_rate"] rescue 0 %>
                  <%= number_to_percentage(dept_rate, precision: 2) %>
                </td>
              </tr>
            <% end %>

            <% if @region_children_data.present? %>
              <tr>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 max-w-xs" title="<%= region_display_name %>">
                  <div class="truncate">
                    <%= display_territory_name(region_display_name) %>
                  </div>
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                  <% region_rate = @region_children_data["three_to_five_rate"] rescue 0 %>
                  <%= number_to_percentage(region_rate, precision: 2) %>
                </td>
              </tr>
            <% end %>

            <% if @france_children_data.present? %>
              <tr>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                  France
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                  <% france_rate = @france_children_data["three_to_five_rate"] rescue 0 %>
                  <%= number_to_percentage(france_rate, precision: 2) %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
