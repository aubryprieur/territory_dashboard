// chartjs-plugin-datalabels@2.2.0 downloaded from https://ga.jspm.io/npm:chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.esm.js

import{isNullOrUndef as t,merge as e,toFont as r,resolve as a,toPadding as i,valueOrDefault as n,callback as o,isObject as l,each as s}from"chart.js/helpers";import{ArcElement as v,PointElement as u,BarElement as c,defaults as d}from"chart.js";var f=function(){if("undefined"!==typeof window){if(window.devicePixelRatio)return window.devicePixelRatio;var t=window.screen;if(t)return(t.deviceXDPI||1)/(t.logicalXDPI||1)}return 1}();var h={toTextLines:function(e){var r=[];var a;e=[].concat(e);while(e.length){a=e.pop();"string"===typeof a?r.unshift.apply(r,a.split("\n")):Array.isArray(a)?e.push.apply(e,a):t(e)||r.unshift(""+a)}return r},textSize:function(t,e,r){var a=[].concat(e);var i=a.length;var n=t.font;var o=0;var l;t.font=r.string;for(l=0;l<i;++l)o=Math.max(t.measureText(a[l]).width,o);t.font=n;return{height:i*r.lineHeight,width:o}},bound:function(t,e,r){return Math.max(t,Math.min(e,r))},arrayDiff:function(t,e){var r=t.slice();var a=[];var i,n,o,l;for(i=0,o=e.length;i<o;++i){l=e[i];n=r.indexOf(l);-1===n?a.push([l,1]):r.splice(n,1)}for(i=0,o=r.length;i<o;++i)a.push([r[i],-1]);return a},rasterize:function(t){return Math.round(t*f)/f}};function orient(t,e){var r=e.x;var a=e.y;if(null===r)return{x:0,y:-1};if(null===a)return{x:1,y:0};var i=t.x-r;var n=t.y-a;var o=Math.sqrt(i*i+n*n);return{x:o?i/o:0,y:o?n/o:-1}}function aligned(t,e,r,a,i){switch(i){case"center":r=a=0;break;case"bottom":r=0;a=1;break;case"right":r=1;a=0;break;case"left":r=-1;a=0;break;case"top":r=0;a=-1;break;case"start":r=-r;a=-a;break;case"end":break;default:i*=Math.PI/180;r=Math.cos(i);a=Math.sin(i);break}return{x:t,y:e,vx:r,vy:a}}var x=0;var y=1;var p=2;var b=4;var _=8;function region(t,e,r){var a=x;t<r.left?a|=y:t>r.right&&(a|=p);e<r.top?a|=_:e>r.bottom&&(a|=b);return a}function clipped(t,e){var r=t.x0;var a=t.y0;var i=t.x1;var n=t.y1;var o=region(r,a,e);var l=region(i,n,e);var s,v,u;while(true){if(!(o|l)||o&l)break;s=o||l;if(s&_){v=r+(i-r)*(e.top-a)/(n-a);u=e.top}else if(s&b){v=r+(i-r)*(e.bottom-a)/(n-a);u=e.bottom}else if(s&p){u=a+(n-a)*(e.right-r)/(i-r);v=e.right}else if(s&y){u=a+(n-a)*(e.left-r)/(i-r);v=e.left}if(s===o){r=v;a=u;o=region(r,a,e)}else{i=v;n=u;l=region(i,n,e)}}return{x0:r,x1:i,y0:a,y1:n}}function compute$1(t,e){var r=e.anchor;var a=t;var i,n;e.clamp&&(a=clipped(a,e.area));if("start"===r){i=a.x0;n=a.y0}else if("end"===r){i=a.x1;n=a.y1}else{i=(a.x0+a.x1)/2;n=(a.y0+a.y1)/2}return aligned(i,n,t.vx,t.vy,e.align)}var g={arc:function(t,e){var r=(t.startAngle+t.endAngle)/2;var a=Math.cos(r);var i=Math.sin(r);var n=t.innerRadius;var o=t.outerRadius;return compute$1({x0:t.x+a*n,y0:t.y+i*n,x1:t.x+a*o,y1:t.y+i*o,vx:a,vy:i},e)},point:function(t,e){var r=orient(t,e.origin);var a=r.x*t.options.radius;var i=r.y*t.options.radius;return compute$1({x0:t.x-a,y0:t.y-i,x1:t.x+a,y1:t.y+i,vx:r.x,vy:r.y},e)},bar:function(t,e){var r=orient(t,e.origin);var a=t.x;var i=t.y;var n=0;var o=0;if(t.horizontal){a=Math.min(t.x,t.base);n=Math.abs(t.base-t.x)}else{i=Math.min(t.y,t.base);o=Math.abs(t.base-t.y)}return compute$1({x0:a,y0:i+o,x1:a+n,y1:i,vx:r.x,vy:r.y},e)},fallback:function(t,e){var r=orient(t,e.origin);return compute$1({x0:t.x,y0:t.y,x1:t.x+(t.width||0),y1:t.y+(t.height||0),vx:r.x,vy:r.y},e)}};var m=h.rasterize;function boundingRects(t){var e=t.borderWidth||0;var r=t.padding;var a=t.size.height;var i=t.size.width;var n=-i/2;var o=-a/2;return{frame:{x:n-r.left-e,y:o-r.top-e,w:i+r.width+2*e,h:a+r.height+2*e},text:{x:n,y:o,w:i,h:a}}}function getScaleOrigin(t,e){var r=e.chart.getDatasetMeta(e.datasetIndex).vScale;if(!r)return null;if(void 0!==r.xCenter&&void 0!==r.yCenter)return{x:r.xCenter,y:r.yCenter};var a=r.getBasePixel();return t.horizontal?{x:a,y:null}:{x:null,y:a}}function getPositioner(t){return t instanceof v?g.arc:t instanceof u?g.point:t instanceof c?g.bar:g.fallback}function drawRoundedRect(t,e,r,a,i,n){var o=Math.PI/2;if(n){var l=Math.min(n,i/2,a/2);var s=e+l;var v=r+l;var u=e+a-l;var c=r+i-l;t.moveTo(e,v);if(s<u&&v<c){t.arc(s,v,l,-Math.PI,-o);t.arc(u,v,l,-o,0);t.arc(u,c,l,0,o);t.arc(s,c,l,o,Math.PI)}else if(s<u){t.moveTo(s,r);t.arc(u,v,l,-o,o);t.arc(s,v,l,o,Math.PI+o)}else if(v<c){t.arc(s,v,l,-Math.PI,0);t.arc(s,c,l,0,Math.PI)}else t.arc(s,v,l,-Math.PI,Math.PI);t.closePath();t.moveTo(e,r)}else t.rect(e,r,a,i)}function drawFrame(t,e,r){var a=r.backgroundColor;var i=r.borderColor;var n=r.borderWidth;if(a||i&&n){t.beginPath();drawRoundedRect(t,m(e.x)+n/2,m(e.y)+n/2,m(e.w)-n,m(e.h)-n,r.borderRadius);t.closePath();if(a){t.fillStyle=a;t.fill()}if(i&&n){t.strokeStyle=i;t.lineWidth=n;t.lineJoin="miter";t.stroke()}}}function textGeometry(t,e,r){var a=r.lineHeight;var i=t.w;var n=t.x;var o=t.y+a/2;"center"===e?n+=i/2:"end"!==e&&"right"!==e||(n+=i);return{h:a,w:i,x:n,y:o}}function drawTextLine(t,e,r){var a=t.shadowBlur;var i=r.stroked;var n=m(r.x);var o=m(r.y);var l=m(r.w);i&&t.strokeText(e,n,o,l);if(r.filled){a&&i&&(t.shadowBlur=0);t.fillText(e,n,o,l);a&&i&&(t.shadowBlur=a)}}function drawText(t,e,r,a){var i=a.textAlign;var n=a.color;var o=!!n;var l=a.font;var s=e.length;var v=a.textStrokeColor;var u=a.textStrokeWidth;var c=v&&u;var d;if(s&&(o||c)){r=textGeometry(r,i,l);t.font=l.string;t.textAlign=i;t.textBaseline="middle";t.shadowBlur=a.textShadowBlur;t.shadowColor=a.textShadowColor;o&&(t.fillStyle=n);if(c){t.lineJoin="round";t.lineWidth=u;t.strokeStyle=v}for(d=0,s=e.length;d<s;++d)drawTextLine(t,e[d],{stroked:c,filled:o,w:r.w,x:r.x,y:r.y+r.h*d})}}var Label=function(t,e,r,a){var i=this;i._config=t;i._index=a;i._model=null;i._rects=null;i._ctx=e;i._el=r};e(Label.prototype,{_modelize:function(t,e,n,o){var l=this;var s=l._index;var v=r(a([n.font,{}],o,s));var u=a([n.color,d.color],o,s);return{align:a([n.align,"center"],o,s),anchor:a([n.anchor,"center"],o,s),area:o.chart.chartArea,backgroundColor:a([n.backgroundColor,null],o,s),borderColor:a([n.borderColor,null],o,s),borderRadius:a([n.borderRadius,0],o,s),borderWidth:a([n.borderWidth,0],o,s),clamp:a([n.clamp,false],o,s),clip:a([n.clip,false],o,s),color:u,display:t,font:v,lines:e,offset:a([n.offset,4],o,s),opacity:a([n.opacity,1],o,s),origin:getScaleOrigin(l._el,o),padding:i(a([n.padding,4],o,s)),positioner:getPositioner(l._el),rotation:a([n.rotation,0],o,s)*(Math.PI/180),size:h.textSize(l._ctx,e,v),textAlign:a([n.textAlign,"start"],o,s),textShadowBlur:a([n.textShadowBlur,0],o,s),textShadowColor:a([n.textShadowColor,u],o,s),textStrokeColor:a([n.textStrokeColor,u],o,s),textStrokeWidth:a([n.textStrokeWidth,0],o,s)}},update:function(e){var r=this;var i=null;var l=null;var s=r._index;var v=r._config;var u,c,d;var f=a([v.display,true],e,s);if(f){u=e.dataset.data[s];c=n(o(v.formatter,[u,e]),u);d=t(c)?[]:h.toTextLines(c);if(d.length){i=r._modelize(f,d,v,e);l=boundingRects(i)}}r._model=i;r._rects=l},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(t,e){var r=this;var a=t.ctx;var i=r._model;var n=r._rects;var o;if(this.visible()){a.save();if(i.clip){o=i.area;a.beginPath();a.rect(o.left,o.top,o.right-o.left,o.bottom-o.top);a.clip()}a.globalAlpha=h.bound(0,i.opacity,1);a.translate(m(e.x),m(e.y));a.rotate(i.rotation);drawFrame(a,n.frame,i);drawText(a,i.lines,n.text,i);a.restore()}}});var w=Number.MIN_SAFE_INTEGER||-9007199254740991;var M=Number.MAX_SAFE_INTEGER||9007199254740991;function rotated(t,e,r){var a=Math.cos(r);var i=Math.sin(r);var n=e.x;var o=e.y;return{x:n+a*(t.x-n)-i*(t.y-o),y:o+i*(t.x-n)+a*(t.y-o)}}function projected(t,e){var r=M;var a=w;var i=e.origin;var n,o,l,s,v;for(n=0;n<t.length;++n){o=t[n];l=o.x-i.x;s=o.y-i.y;v=e.vx*l+e.vy*s;r=Math.min(r,v);a=Math.max(a,v)}return{min:r,max:a}}function toAxis(t,e){var r=e.x-t.x;var a=e.y-t.y;var i=Math.sqrt(r*r+a*a);return{vx:(e.x-t.x)/i,vy:(e.y-t.y)/i,origin:t,ln:i}}var HitBox=function(){this._rotation=0;this._rect={x:0,y:0,w:0,h:0}};e(HitBox.prototype,{center:function(){var t=this._rect;return{x:t.x+t.w/2,y:t.y+t.h/2}},update:function(t,e,r){this._rotation=r;this._rect={x:e.x+t.x,y:e.y+t.y,w:e.w,h:e.h}},contains:function(t){var e=this;var r=1;var a=e._rect;t=rotated(t,e.center(),-e._rotation);return!(t.x<a.x-r||t.y<a.y-r||t.x>a.x+a.w+2*r||t.y>a.y+a.h+2*r)},intersects:function(t){var e=this._points();var r=t._points();var a=[toAxis(e[0],e[1]),toAxis(e[0],e[3])];var i,n,o;this._rotation!==t._rotation&&a.push(toAxis(r[0],r[1]),toAxis(r[0],r[3]));for(i=0;i<a.length;++i){n=projected(e,a[i]);o=projected(r,a[i]);if(n.max<o.min||o.max<n.min)return false}return true},_points:function(){var t=this;var e=t._rect;var r=t._rotation;var a=t.center();return[rotated({x:e.x,y:e.y},a,r),rotated({x:e.x+e.w,y:e.y},a,r),rotated({x:e.x+e.w,y:e.y+e.h},a,r),rotated({x:e.x,y:e.y+e.h},a,r)]}});function coordinates(t,e,r){var a=e.positioner(t,e);var i=a.vx;var n=a.vy;if(!i&&!n)return{x:a.x,y:a.y};var o=r.w;var l=r.h;var s=e.rotation;var v=Math.abs(o/2*Math.cos(s))+Math.abs(l/2*Math.sin(s));var u=Math.abs(o/2*Math.sin(s))+Math.abs(l/2*Math.cos(s));var c=1/Math.max(Math.abs(i),Math.abs(n));v*=i*c;u*=n*c;v+=e.offset*i;u+=e.offset*n;return{x:a.x+v,y:a.y+u}}function collide(t,e){var r,a,i,n;for(r=t.length-1;r>=0;--r){i=t[r].$layout;for(a=r-1;a>=0&&i._visible;--a){n=t[a].$layout;n._visible&&i._box.intersects(n._box)&&e(i,n)}}return t}function compute(t){var e,r,a,i,n,o,l;for(e=0,r=t.length;e<r;++e){a=t[e];i=a.$layout;if(i._visible){l=new Proxy(a._el,{get:(t,e)=>t.getProps([e],true)[e]});n=a.geometry();o=coordinates(l,a.model(),n);i._box.update(o,n,a.rotation())}}return collide(t,(function(t,e){var r=t._hidable;var a=e._hidable;r&&a||a?e._visible=false:r&&(t._visible=false)}))}var k={prepare:function(t){var e=[];var r,a,i,n,o;for(r=0,i=t.length;r<i;++r)for(a=0,n=t[r].length;a<n;++a){o=t[r][a];e.push(o);o.$layout={_box:new HitBox,_hidable:false,_visible:true,_set:r,_idx:o._index}}e.sort((function(t,e){var r=t.$layout;var a=e.$layout;return r._idx===a._idx?a._set-r._set:a._idx-r._idx}));this.update(e);return e},update:function(t){var e=false;var r,a,i,n,o;for(r=0,a=t.length;r<a;++r){i=t[r];n=i.model();o=i.$layout;o._hidable=n&&"auto"===n.display;o._visible=i.visible();e|=o._hidable}e&&compute(t)},lookup:function(t,e){var r,a;for(r=t.length-1;r>=0;--r){a=t[r].$layout;if(a&&a._visible&&a._box.contains(e))return t[r]}return null},draw:function(t,e){var r,a,i,n,o,l;for(r=0,a=e.length;r<a;++r){i=e[r];n=i.$layout;if(n._visible){o=i.geometry();l=coordinates(i._el,i.model(),o);n._box.update(l,o,i.rotation());i.draw(t,l)}}}};var formatter=function(e){if(t(e))return null;var r=e;var a,i,n;if(l(e))if(t(e.label))if(t(e.r)){r="";a=Object.keys(e);for(n=0,i=a.length;n<i;++n)r+=(0!==n?", ":"")+a[n]+": "+e[a[n]]}else r=e.r;else r=e.label;return""+r};var S={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:false,clip:false,color:void 0,display:true,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:formatter,labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0};var C="$datalabels";var P="$default";function configure(t,r){var a=t.datalabels;var i={};var n=[];var o,l;if(false===a)return null;true===a&&(a={});r=e({},[r,a]);o=r.labels||{};l=Object.keys(o);delete r.labels;l.length?l.forEach((function(t){o[t]&&n.push(e({},[r,o[t],{_key:t}]))})):n.push(r);i=n.reduce((function(t,e){s(e.listeners||{},(function(r,a){t[a]=t[a]||{};t[a][e._key||P]=r}));delete e.listeners;return t}),{});return{labels:n,listeners:i}}function dispatchEvent(t,e,r,a){if(e){var i=r.$context;var n=r.$groups;var l;if(e[n._set]){l=e[n._set][n._key];if(l&&true===o(l,[i,a])){t[C]._dirty=true;r.update(i)}}}}function dispatchMoveEvents(t,e,r,a,i){var n,o;if(r||a){r?a?r!==a&&(o=n=true):o=true:n=true;o&&dispatchEvent(t,e.leave,r,i);n&&dispatchEvent(t,e.enter,a,i)}}function handleMoveEvents(t,e){var r=t[C];var a=r._listeners;var i,n;if(a.enter||a.leave){if("mousemove"===e.type)n=k.lookup(r._labels,e);else if("mouseout"!==e.type)return;i=r._hovered;r._hovered=n;dispatchMoveEvents(t,a,i,n,e)}}function handleClickEvents(t,e){var r=t[C];var a=r._listeners.click;var i=a&&k.lookup(r._labels,e);i&&dispatchEvent(t,a,i,e)}var $={id:"datalabels",defaults:S,beforeInit:function(t){t[C]={_actives:[]}},beforeUpdate:function(t){var e=t[C];e._listened=false;e._listeners={};e._datasets=[];e._labels=[]},afterDatasetUpdate:function(t,r,a){var i=r.index;var n=t[C];var o=n._datasets[i]=[];var l=t.isDatasetVisible(i);var s=t.data.datasets[i];var v=configure(s,a);var u=r.meta.data||[];var c=t.ctx;var d,f,h,x,y,p,b,_;c.save();for(d=0,h=u.length;d<h;++d){b=u[d];b[C]=[];if(l&&b&&t.getDataVisibility(d)&&!b.skip)for(f=0,x=v.labels.length;f<x;++f){y=v.labels[f];p=y._key;_=new Label(y,c,b,d);_.$groups={_set:i,_key:p||P};_.$context={active:false,chart:t,dataIndex:d,dataset:s,datasetIndex:i};_.update(_.$context);b[C].push(_);o.push(_)}}c.restore();e(n._listeners,v.listeners,{merger:function(t,e,a){e[t]=e[t]||{};e[t][r.index]=a[t];n._listened=true}})},afterUpdate:function(t){t[C]._labels=k.prepare(t[C]._datasets)},afterDatasetsDraw:function(t){k.draw(t,t[C]._labels)},beforeEvent:function(t,e){if(t[C]._listened){var r=e.event;switch(r.type){case"mousemove":case"mouseout":handleMoveEvents(t,r);break;case"click":handleClickEvents(t,r);break}}},afterEvent:function(t){var e=t[C];var r=e._actives;var a=e._actives=t.getActiveElements();var i=h.arrayDiff(r,a);var n,o,l,s,v,u,c;for(n=0,o=i.length;n<o;++n){v=i[n];if(v[1]){c=v[0].element[C]||[];for(l=0,s=c.length;l<s;++l){u=c[l];u.$context.active=1===v[1];u.update(u.$context)}}}if(e._dirty||i.length){k.update(e._labels);t.render()}delete e._dirty}};export{$ as default};

